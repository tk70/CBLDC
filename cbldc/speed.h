/*
 * speed.h
 *
 * Created: 2014-12-25 03:27:24
 *  Author: Jakub Turowski
 *
 * This module converts 16bit commutation time into 16bit speed in RPS (rounds per second)
 * Since f = 1 / t, a division operation is needed to convert commutation time into motor
 * speed in RPS. Unfortunately it cannot be done in reasonable time on AVR, within single
 * motor cycle. We will be using lookup tables.
 */ 

#ifndef SPEED_H_
#define SPEED_H_

#include <avr/pgmspace.h>
#include "globals.h"

#define RPM_TO_RPS(rpm) (rpm / 60)
#define RPM_TO_COM_TIME(rpm) (10UL * TICKS_PER_SECOND / rpm)

// If we look at f(x) = 1/x plot, we can see that making one LUT for entire range makes no sense.
// There are two lookup tables, for high speeds (commutation time <= 512) and for low speeds (com time > 512)

// High speed lookup table
PROGMEM const uint16_t speed_lutH[];

// Low speed lookup table
PROGMEM const uint16_t speed_lutL[];

uint16_t com_time_to_rps_low(uint16_t t)
{
	if (t < 32768) {
		// Low speed, find two near points in the table and interpolate between them.
		// Calculate weights r and l
		t -= 512;
		
		// r = t % 128
		uint8_t r = (uint8_t)t;
		r &= 127;
		
		// t = t / 128
		t <<= 1;
		t >>= 8;
		
		uint8_t l = 128 - r;

		// Get the two points from the table
		uint16_t L = pgm_read_word(&(speed_lutL[t]));
		uint16_t R = pgm_read_word(&(speed_lutL[t+1]));
		
		// Now we need to multiply the two LUT points by weights and divide by 128.
		// Result = (L*l + R*r) / 128, where 0 <= l <= 128 and 0 <= r <= 127.
		// In fact we will be dividing by 256, skipping LSB of multiplication results.
		// We can do that because LUT values are already multiplied by 2.
		return mul16_frac8_sum_mul16_frac8(L, l, R, r);
		
	} else 
		return TICKS_PER_SECOND/6 / 32768;
}

inline uint16_t com_time_to_rps(uint16_t t)
{
	if (t < 512) {
		// High speed, return directly from the table
		return pgm_read_word(&(speed_lutH[t]));
	}
	else {
		return com_time_to_rps_low(t);
	}	
}

PROGMEM const uint16_t speed_lutH[] = {
	TICKS_PER_SECOND/6 / 1 > 65535? 65535 : TICKS_PER_SECOND/6 / 1,
	TICKS_PER_SECOND/6 / 2 > 65535? 65535 : TICKS_PER_SECOND/6 / 2,
	TICKS_PER_SECOND/6 / 3 > 65535? 65535 : TICKS_PER_SECOND/6 / 3,
	TICKS_PER_SECOND/6 / 4 > 65535? 65535 : TICKS_PER_SECOND/6 / 4,
	TICKS_PER_SECOND/6 / 5 > 65535? 65535 : TICKS_PER_SECOND/6 / 5,
	TICKS_PER_SECOND/6 / 6 > 65535? 65535 : TICKS_PER_SECOND/6 / 6,
	TICKS_PER_SECOND/6 / 7 > 65535? 65535 : TICKS_PER_SECOND/6 / 7,
	TICKS_PER_SECOND/6 / 8 > 65535? 65535 : TICKS_PER_SECOND/6 / 8,
	TICKS_PER_SECOND/6 / 9 > 65535? 65535 : TICKS_PER_SECOND/6 / 9,
	TICKS_PER_SECOND/6 / 10 > 65535? 65535 : TICKS_PER_SECOND/6 / 10,
	TICKS_PER_SECOND/6 / 11 > 65535? 65535 : TICKS_PER_SECOND/6 / 11,
	TICKS_PER_SECOND/6 / 12 > 65535? 65535 : TICKS_PER_SECOND/6 / 12,
	TICKS_PER_SECOND/6 / 13 > 65535? 65535 : TICKS_PER_SECOND/6 / 13,
	TICKS_PER_SECOND/6 / 14 > 65535? 65535 : TICKS_PER_SECOND/6 / 14,
	TICKS_PER_SECOND/6 / 15 > 65535? 65535 : TICKS_PER_SECOND/6 / 15,
	TICKS_PER_SECOND/6 / 16 > 65535? 65535 : TICKS_PER_SECOND/6 / 16,
	TICKS_PER_SECOND/6 / 17,
	TICKS_PER_SECOND/6 / 18,
	TICKS_PER_SECOND/6 / 19,
	TICKS_PER_SECOND/6 / 20,
	TICKS_PER_SECOND/6 / 21,
	TICKS_PER_SECOND/6 / 22,
	TICKS_PER_SECOND/6 / 23,
	TICKS_PER_SECOND/6 / 24,
	TICKS_PER_SECOND/6 / 25,
	TICKS_PER_SECOND/6 / 26,
	TICKS_PER_SECOND/6 / 27,
	TICKS_PER_SECOND/6 / 28,
	TICKS_PER_SECOND/6 / 29,
	TICKS_PER_SECOND/6 / 30,
	TICKS_PER_SECOND/6 / 31,
	TICKS_PER_SECOND/6 / 32,
	TICKS_PER_SECOND/6 / 33,
	TICKS_PER_SECOND/6 / 34,
	TICKS_PER_SECOND/6 / 35,
	TICKS_PER_SECOND/6 / 36,
	TICKS_PER_SECOND/6 / 37,
	TICKS_PER_SECOND/6 / 38,
	TICKS_PER_SECOND/6 / 39,
	TICKS_PER_SECOND/6 / 40,
	TICKS_PER_SECOND/6 / 41,
	TICKS_PER_SECOND/6 / 42,
	TICKS_PER_SECOND/6 / 43,
	TICKS_PER_SECOND/6 / 44,
	TICKS_PER_SECOND/6 / 45,
	TICKS_PER_SECOND/6 / 46,
	TICKS_PER_SECOND/6 / 47,
	TICKS_PER_SECOND/6 / 48,
	TICKS_PER_SECOND/6 / 49,
	TICKS_PER_SECOND/6 / 50,
	TICKS_PER_SECOND/6 / 51,
	TICKS_PER_SECOND/6 / 52,
	TICKS_PER_SECOND/6 / 53,
	TICKS_PER_SECOND/6 / 54,
	TICKS_PER_SECOND/6 / 55,
	TICKS_PER_SECOND/6 / 56,
	TICKS_PER_SECOND/6 / 57,
	TICKS_PER_SECOND/6 / 58,
	TICKS_PER_SECOND/6 / 59,
	TICKS_PER_SECOND/6 / 60,
	TICKS_PER_SECOND/6 / 61,
	TICKS_PER_SECOND/6 / 62,
	TICKS_PER_SECOND/6 / 63,
	TICKS_PER_SECOND/6 / 64,
	TICKS_PER_SECOND/6 / 65,
	TICKS_PER_SECOND/6 / 66,
	TICKS_PER_SECOND/6 / 67,
	TICKS_PER_SECOND/6 / 68,
	TICKS_PER_SECOND/6 / 69,
	TICKS_PER_SECOND/6 / 70,
	TICKS_PER_SECOND/6 / 71,
	TICKS_PER_SECOND/6 / 72,
	TICKS_PER_SECOND/6 / 73,
	TICKS_PER_SECOND/6 / 74,
	TICKS_PER_SECOND/6 / 75,
	TICKS_PER_SECOND/6 / 76,
	TICKS_PER_SECOND/6 / 77,
	TICKS_PER_SECOND/6 / 78,
	TICKS_PER_SECOND/6 / 79,
	TICKS_PER_SECOND/6 / 80,
	TICKS_PER_SECOND/6 / 81,
	TICKS_PER_SECOND/6 / 82,
	TICKS_PER_SECOND/6 / 83,
	TICKS_PER_SECOND/6 / 84,
	TICKS_PER_SECOND/6 / 85,
	TICKS_PER_SECOND/6 / 86,
	TICKS_PER_SECOND/6 / 87,
	TICKS_PER_SECOND/6 / 88,
	TICKS_PER_SECOND/6 / 89,
	TICKS_PER_SECOND/6 / 90,
	TICKS_PER_SECOND/6 / 91,
	TICKS_PER_SECOND/6 / 92,
	TICKS_PER_SECOND/6 / 93,
	TICKS_PER_SECOND/6 / 94,
	TICKS_PER_SECOND/6 / 95,
	TICKS_PER_SECOND/6 / 96,
	TICKS_PER_SECOND/6 / 97,
	TICKS_PER_SECOND/6 / 98,
	TICKS_PER_SECOND/6 / 99,
	TICKS_PER_SECOND/6 / 100,
	TICKS_PER_SECOND/6 / 101,
	TICKS_PER_SECOND/6 / 102,
	TICKS_PER_SECOND/6 / 103,
	TICKS_PER_SECOND/6 / 104,
	TICKS_PER_SECOND/6 / 105,
	TICKS_PER_SECOND/6 / 106,
	TICKS_PER_SECOND/6 / 107,
	TICKS_PER_SECOND/6 / 108,
	TICKS_PER_SECOND/6 / 109,
	TICKS_PER_SECOND/6 / 110,
	TICKS_PER_SECOND/6 / 111,
	TICKS_PER_SECOND/6 / 112,
	TICKS_PER_SECOND/6 / 113,
	TICKS_PER_SECOND/6 / 114,
	TICKS_PER_SECOND/6 / 115,
	TICKS_PER_SECOND/6 / 116,
	TICKS_PER_SECOND/6 / 117,
	TICKS_PER_SECOND/6 / 118,
	TICKS_PER_SECOND/6 / 119,
	TICKS_PER_SECOND/6 / 120,
	TICKS_PER_SECOND/6 / 121,
	TICKS_PER_SECOND/6 / 122,
	TICKS_PER_SECOND/6 / 123,
	TICKS_PER_SECOND/6 / 124,
	TICKS_PER_SECOND/6 / 125,
	TICKS_PER_SECOND/6 / 126,
	TICKS_PER_SECOND/6 / 127,
	TICKS_PER_SECOND/6 / 128,
	TICKS_PER_SECOND/6 / 129,
	TICKS_PER_SECOND/6 / 130,
	TICKS_PER_SECOND/6 / 131,
	TICKS_PER_SECOND/6 / 132,
	TICKS_PER_SECOND/6 / 133,
	TICKS_PER_SECOND/6 / 134,
	TICKS_PER_SECOND/6 / 135,
	TICKS_PER_SECOND/6 / 136,
	TICKS_PER_SECOND/6 / 137,
	TICKS_PER_SECOND/6 / 138,
	TICKS_PER_SECOND/6 / 139,
	TICKS_PER_SECOND/6 / 140,
	TICKS_PER_SECOND/6 / 141,
	TICKS_PER_SECOND/6 / 142,
	TICKS_PER_SECOND/6 / 143,
	TICKS_PER_SECOND/6 / 144,
	TICKS_PER_SECOND/6 / 145,
	TICKS_PER_SECOND/6 / 146,
	TICKS_PER_SECOND/6 / 147,
	TICKS_PER_SECOND/6 / 148,
	TICKS_PER_SECOND/6 / 149,
	TICKS_PER_SECOND/6 / 150,
	TICKS_PER_SECOND/6 / 151,
	TICKS_PER_SECOND/6 / 152,
	TICKS_PER_SECOND/6 / 153,
	TICKS_PER_SECOND/6 / 154,
	TICKS_PER_SECOND/6 / 155,
	TICKS_PER_SECOND/6 / 156,
	TICKS_PER_SECOND/6 / 157,
	TICKS_PER_SECOND/6 / 158,
	TICKS_PER_SECOND/6 / 159,
	TICKS_PER_SECOND/6 / 160,
	TICKS_PER_SECOND/6 / 161,
	TICKS_PER_SECOND/6 / 162,
	TICKS_PER_SECOND/6 / 163,
	TICKS_PER_SECOND/6 / 164,
	TICKS_PER_SECOND/6 / 165,
	TICKS_PER_SECOND/6 / 166,
	TICKS_PER_SECOND/6 / 167,
	TICKS_PER_SECOND/6 / 168,
	TICKS_PER_SECOND/6 / 169,
	TICKS_PER_SECOND/6 / 170,
	TICKS_PER_SECOND/6 / 171,
	TICKS_PER_SECOND/6 / 172,
	TICKS_PER_SECOND/6 / 173,
	TICKS_PER_SECOND/6 / 174,
	TICKS_PER_SECOND/6 / 175,
	TICKS_PER_SECOND/6 / 176,
	TICKS_PER_SECOND/6 / 177,
	TICKS_PER_SECOND/6 / 178,
	TICKS_PER_SECOND/6 / 179,
	TICKS_PER_SECOND/6 / 180,
	TICKS_PER_SECOND/6 / 181,
	TICKS_PER_SECOND/6 / 182,
	TICKS_PER_SECOND/6 / 183,
	TICKS_PER_SECOND/6 / 184,
	TICKS_PER_SECOND/6 / 185,
	TICKS_PER_SECOND/6 / 186,
	TICKS_PER_SECOND/6 / 187,
	TICKS_PER_SECOND/6 / 188,
	TICKS_PER_SECOND/6 / 189,
	TICKS_PER_SECOND/6 / 190,
	TICKS_PER_SECOND/6 / 191,
	TICKS_PER_SECOND/6 / 192,
	TICKS_PER_SECOND/6 / 193,
	TICKS_PER_SECOND/6 / 194,
	TICKS_PER_SECOND/6 / 195,
	TICKS_PER_SECOND/6 / 196,
	TICKS_PER_SECOND/6 / 197,
	TICKS_PER_SECOND/6 / 198,
	TICKS_PER_SECOND/6 / 199,
	TICKS_PER_SECOND/6 / 200,
	TICKS_PER_SECOND/6 / 201,
	TICKS_PER_SECOND/6 / 202,
	TICKS_PER_SECOND/6 / 203,
	TICKS_PER_SECOND/6 / 204,
	TICKS_PER_SECOND/6 / 205,
	TICKS_PER_SECOND/6 / 206,
	TICKS_PER_SECOND/6 / 207,
	TICKS_PER_SECOND/6 / 208,
	TICKS_PER_SECOND/6 / 209,
	TICKS_PER_SECOND/6 / 210,
	TICKS_PER_SECOND/6 / 211,
	TICKS_PER_SECOND/6 / 212,
	TICKS_PER_SECOND/6 / 213,
	TICKS_PER_SECOND/6 / 214,
	TICKS_PER_SECOND/6 / 215,
	TICKS_PER_SECOND/6 / 216,
	TICKS_PER_SECOND/6 / 217,
	TICKS_PER_SECOND/6 / 218,
	TICKS_PER_SECOND/6 / 219,
	TICKS_PER_SECOND/6 / 220,
	TICKS_PER_SECOND/6 / 221,
	TICKS_PER_SECOND/6 / 222,
	TICKS_PER_SECOND/6 / 223,
	TICKS_PER_SECOND/6 / 224,
	TICKS_PER_SECOND/6 / 225,
	TICKS_PER_SECOND/6 / 226,
	TICKS_PER_SECOND/6 / 227,
	TICKS_PER_SECOND/6 / 228,
	TICKS_PER_SECOND/6 / 229,
	TICKS_PER_SECOND/6 / 230,
	TICKS_PER_SECOND/6 / 231,
	TICKS_PER_SECOND/6 / 232,
	TICKS_PER_SECOND/6 / 233,
	TICKS_PER_SECOND/6 / 234,
	TICKS_PER_SECOND/6 / 235,
	TICKS_PER_SECOND/6 / 236,
	TICKS_PER_SECOND/6 / 237,
	TICKS_PER_SECOND/6 / 238,
	TICKS_PER_SECOND/6 / 239,
	TICKS_PER_SECOND/6 / 240,
	TICKS_PER_SECOND/6 / 241,
	TICKS_PER_SECOND/6 / 242,
	TICKS_PER_SECOND/6 / 243,
	TICKS_PER_SECOND/6 / 244,
	TICKS_PER_SECOND/6 / 245,
	TICKS_PER_SECOND/6 / 246,
	TICKS_PER_SECOND/6 / 247,
	TICKS_PER_SECOND/6 / 248,
	TICKS_PER_SECOND/6 / 249,
	TICKS_PER_SECOND/6 / 250,
	TICKS_PER_SECOND/6 / 251,
	TICKS_PER_SECOND/6 / 252,
	TICKS_PER_SECOND/6 / 253,
	TICKS_PER_SECOND/6 / 254,
	TICKS_PER_SECOND/6 / 255,
	TICKS_PER_SECOND/6 / 256,
	TICKS_PER_SECOND/6 / 257,
	TICKS_PER_SECOND/6 / 258,
	TICKS_PER_SECOND/6 / 259,
	TICKS_PER_SECOND/6 / 260,
	TICKS_PER_SECOND/6 / 261,
	TICKS_PER_SECOND/6 / 262,
	TICKS_PER_SECOND/6 / 263,
	TICKS_PER_SECOND/6 / 264,
	TICKS_PER_SECOND/6 / 265,
	TICKS_PER_SECOND/6 / 266,
	TICKS_PER_SECOND/6 / 267,
	TICKS_PER_SECOND/6 / 268,
	TICKS_PER_SECOND/6 / 269,
	TICKS_PER_SECOND/6 / 270,
	TICKS_PER_SECOND/6 / 271,
	TICKS_PER_SECOND/6 / 272,
	TICKS_PER_SECOND/6 / 273,
	TICKS_PER_SECOND/6 / 274,
	TICKS_PER_SECOND/6 / 275,
	TICKS_PER_SECOND/6 / 276,
	TICKS_PER_SECOND/6 / 277,
	TICKS_PER_SECOND/6 / 278,
	TICKS_PER_SECOND/6 / 279,
	TICKS_PER_SECOND/6 / 280,
	TICKS_PER_SECOND/6 / 281,
	TICKS_PER_SECOND/6 / 282,
	TICKS_PER_SECOND/6 / 283,
	TICKS_PER_SECOND/6 / 284,
	TICKS_PER_SECOND/6 / 285,
	TICKS_PER_SECOND/6 / 286,
	TICKS_PER_SECOND/6 / 287,
	TICKS_PER_SECOND/6 / 288,
	TICKS_PER_SECOND/6 / 289,
	TICKS_PER_SECOND/6 / 290,
	TICKS_PER_SECOND/6 / 291,
	TICKS_PER_SECOND/6 / 292,
	TICKS_PER_SECOND/6 / 293,
	TICKS_PER_SECOND/6 / 294,
	TICKS_PER_SECOND/6 / 295,
	TICKS_PER_SECOND/6 / 296,
	TICKS_PER_SECOND/6 / 297,
	TICKS_PER_SECOND/6 / 298,
	TICKS_PER_SECOND/6 / 299,
	TICKS_PER_SECOND/6 / 300,
	TICKS_PER_SECOND/6 / 301,
	TICKS_PER_SECOND/6 / 302,
	TICKS_PER_SECOND/6 / 303,
	TICKS_PER_SECOND/6 / 304,
	TICKS_PER_SECOND/6 / 305,
	TICKS_PER_SECOND/6 / 306,
	TICKS_PER_SECOND/6 / 307,
	TICKS_PER_SECOND/6 / 308,
	TICKS_PER_SECOND/6 / 309,
	TICKS_PER_SECOND/6 / 310,
	TICKS_PER_SECOND/6 / 311,
	TICKS_PER_SECOND/6 / 312,
	TICKS_PER_SECOND/6 / 313,
	TICKS_PER_SECOND/6 / 314,
	TICKS_PER_SECOND/6 / 315,
	TICKS_PER_SECOND/6 / 316,
	TICKS_PER_SECOND/6 / 317,
	TICKS_PER_SECOND/6 / 318,
	TICKS_PER_SECOND/6 / 319,
	TICKS_PER_SECOND/6 / 320,
	TICKS_PER_SECOND/6 / 321,
	TICKS_PER_SECOND/6 / 322,
	TICKS_PER_SECOND/6 / 323,
	TICKS_PER_SECOND/6 / 324,
	TICKS_PER_SECOND/6 / 325,
	TICKS_PER_SECOND/6 / 326,
	TICKS_PER_SECOND/6 / 327,
	TICKS_PER_SECOND/6 / 328,
	TICKS_PER_SECOND/6 / 329,
	TICKS_PER_SECOND/6 / 330,
	TICKS_PER_SECOND/6 / 331,
	TICKS_PER_SECOND/6 / 332,
	TICKS_PER_SECOND/6 / 333,
	TICKS_PER_SECOND/6 / 334,
	TICKS_PER_SECOND/6 / 335,
	TICKS_PER_SECOND/6 / 336,
	TICKS_PER_SECOND/6 / 337,
	TICKS_PER_SECOND/6 / 338,
	TICKS_PER_SECOND/6 / 339,
	TICKS_PER_SECOND/6 / 340,
	TICKS_PER_SECOND/6 / 341,
	TICKS_PER_SECOND/6 / 342,
	TICKS_PER_SECOND/6 / 343,
	TICKS_PER_SECOND/6 / 344,
	TICKS_PER_SECOND/6 / 345,
	TICKS_PER_SECOND/6 / 346,
	TICKS_PER_SECOND/6 / 347,
	TICKS_PER_SECOND/6 / 348,
	TICKS_PER_SECOND/6 / 349,
	TICKS_PER_SECOND/6 / 350,
	TICKS_PER_SECOND/6 / 351,
	TICKS_PER_SECOND/6 / 352,
	TICKS_PER_SECOND/6 / 353,
	TICKS_PER_SECOND/6 / 354,
	TICKS_PER_SECOND/6 / 355,
	TICKS_PER_SECOND/6 / 356,
	TICKS_PER_SECOND/6 / 357,
	TICKS_PER_SECOND/6 / 358,
	TICKS_PER_SECOND/6 / 359,
	TICKS_PER_SECOND/6 / 360,
	TICKS_PER_SECOND/6 / 361,
	TICKS_PER_SECOND/6 / 362,
	TICKS_PER_SECOND/6 / 363,
	TICKS_PER_SECOND/6 / 364,
	TICKS_PER_SECOND/6 / 365,
	TICKS_PER_SECOND/6 / 366,
	TICKS_PER_SECOND/6 / 367,
	TICKS_PER_SECOND/6 / 368,
	TICKS_PER_SECOND/6 / 369,
	TICKS_PER_SECOND/6 / 370,
	TICKS_PER_SECOND/6 / 371,
	TICKS_PER_SECOND/6 / 372,
	TICKS_PER_SECOND/6 / 373,
	TICKS_PER_SECOND/6 / 374,
	TICKS_PER_SECOND/6 / 375,
	TICKS_PER_SECOND/6 / 376,
	TICKS_PER_SECOND/6 / 377,
	TICKS_PER_SECOND/6 / 378,
	TICKS_PER_SECOND/6 / 379,
	TICKS_PER_SECOND/6 / 380,
	TICKS_PER_SECOND/6 / 381,
	TICKS_PER_SECOND/6 / 382,
	TICKS_PER_SECOND/6 / 383,
	TICKS_PER_SECOND/6 / 384,
	TICKS_PER_SECOND/6 / 385,
	TICKS_PER_SECOND/6 / 386,
	TICKS_PER_SECOND/6 / 387,
	TICKS_PER_SECOND/6 / 388,
	TICKS_PER_SECOND/6 / 389,
	TICKS_PER_SECOND/6 / 390,
	TICKS_PER_SECOND/6 / 391,
	TICKS_PER_SECOND/6 / 392,
	TICKS_PER_SECOND/6 / 393,
	TICKS_PER_SECOND/6 / 394,
	TICKS_PER_SECOND/6 / 395,
	TICKS_PER_SECOND/6 / 396,
	TICKS_PER_SECOND/6 / 397,
	TICKS_PER_SECOND/6 / 398,
	TICKS_PER_SECOND/6 / 399,
	TICKS_PER_SECOND/6 / 400,
	TICKS_PER_SECOND/6 / 401,
	TICKS_PER_SECOND/6 / 402,
	TICKS_PER_SECOND/6 / 403,
	TICKS_PER_SECOND/6 / 404,
	TICKS_PER_SECOND/6 / 405,
	TICKS_PER_SECOND/6 / 406,
	TICKS_PER_SECOND/6 / 407,
	TICKS_PER_SECOND/6 / 408,
	TICKS_PER_SECOND/6 / 409,
	TICKS_PER_SECOND/6 / 410,
	TICKS_PER_SECOND/6 / 411,
	TICKS_PER_SECOND/6 / 412,
	TICKS_PER_SECOND/6 / 413,
	TICKS_PER_SECOND/6 / 414,
	TICKS_PER_SECOND/6 / 415,
	TICKS_PER_SECOND/6 / 416,
	TICKS_PER_SECOND/6 / 417,
	TICKS_PER_SECOND/6 / 418,
	TICKS_PER_SECOND/6 / 419,
	TICKS_PER_SECOND/6 / 420,
	TICKS_PER_SECOND/6 / 421,
	TICKS_PER_SECOND/6 / 422,
	TICKS_PER_SECOND/6 / 423,
	TICKS_PER_SECOND/6 / 424,
	TICKS_PER_SECOND/6 / 425,
	TICKS_PER_SECOND/6 / 426,
	TICKS_PER_SECOND/6 / 427,
	TICKS_PER_SECOND/6 / 428,
	TICKS_PER_SECOND/6 / 429,
	TICKS_PER_SECOND/6 / 430,
	TICKS_PER_SECOND/6 / 431,
	TICKS_PER_SECOND/6 / 432,
	TICKS_PER_SECOND/6 / 433,
	TICKS_PER_SECOND/6 / 434,
	TICKS_PER_SECOND/6 / 435,
	TICKS_PER_SECOND/6 / 436,
	TICKS_PER_SECOND/6 / 437,
	TICKS_PER_SECOND/6 / 438,
	TICKS_PER_SECOND/6 / 439,
	TICKS_PER_SECOND/6 / 440,
	TICKS_PER_SECOND/6 / 441,
	TICKS_PER_SECOND/6 / 442,
	TICKS_PER_SECOND/6 / 443,
	TICKS_PER_SECOND/6 / 444,
	TICKS_PER_SECOND/6 / 445,
	TICKS_PER_SECOND/6 / 446,
	TICKS_PER_SECOND/6 / 447,
	TICKS_PER_SECOND/6 / 448,
	TICKS_PER_SECOND/6 / 449,
	TICKS_PER_SECOND/6 / 450,
	TICKS_PER_SECOND/6 / 451,
	TICKS_PER_SECOND/6 / 452,
	TICKS_PER_SECOND/6 / 453,
	TICKS_PER_SECOND/6 / 454,
	TICKS_PER_SECOND/6 / 455,
	TICKS_PER_SECOND/6 / 456,
	TICKS_PER_SECOND/6 / 457,
	TICKS_PER_SECOND/6 / 458,
	TICKS_PER_SECOND/6 / 459,
	TICKS_PER_SECOND/6 / 460,
	TICKS_PER_SECOND/6 / 461,
	TICKS_PER_SECOND/6 / 462,
	TICKS_PER_SECOND/6 / 463,
	TICKS_PER_SECOND/6 / 464,
	TICKS_PER_SECOND/6 / 465,
	TICKS_PER_SECOND/6 / 466,
	TICKS_PER_SECOND/6 / 467,
	TICKS_PER_SECOND/6 / 468,
	TICKS_PER_SECOND/6 / 469,
	TICKS_PER_SECOND/6 / 470,
	TICKS_PER_SECOND/6 / 471,
	TICKS_PER_SECOND/6 / 472,
	TICKS_PER_SECOND/6 / 473,
	TICKS_PER_SECOND/6 / 474,
	TICKS_PER_SECOND/6 / 475,
	TICKS_PER_SECOND/6 / 476,
	TICKS_PER_SECOND/6 / 477,
	TICKS_PER_SECOND/6 / 478,
	TICKS_PER_SECOND/6 / 479,
	TICKS_PER_SECOND/6 / 480,
	TICKS_PER_SECOND/6 / 481,
	TICKS_PER_SECOND/6 / 482,
	TICKS_PER_SECOND/6 / 483,
	TICKS_PER_SECOND/6 / 484,
	TICKS_PER_SECOND/6 / 485,
	TICKS_PER_SECOND/6 / 486,
	TICKS_PER_SECOND/6 / 487,
	TICKS_PER_SECOND/6 / 488,
	TICKS_PER_SECOND/6 / 489,
	TICKS_PER_SECOND/6 / 490,
	TICKS_PER_SECOND/6 / 491,
	TICKS_PER_SECOND/6 / 492,
	TICKS_PER_SECOND/6 / 493,
	TICKS_PER_SECOND/6 / 494,
	TICKS_PER_SECOND/6 / 495,
	TICKS_PER_SECOND/6 / 496,
	TICKS_PER_SECOND/6 / 497,
	TICKS_PER_SECOND/6 / 498,
	TICKS_PER_SECOND/6 / 499,
	TICKS_PER_SECOND/6 / 500,
	TICKS_PER_SECOND/6 / 501,
	TICKS_PER_SECOND/6 / 502,
	TICKS_PER_SECOND/6 / 503,
	TICKS_PER_SECOND/6 / 504,
	TICKS_PER_SECOND/6 / 505,
	TICKS_PER_SECOND/6 / 506,
	TICKS_PER_SECOND/6 / 507,
	TICKS_PER_SECOND/6 / 508,
	TICKS_PER_SECOND/6 / 509,
	TICKS_PER_SECOND/6 / 510,
	TICKS_PER_SECOND/6 / 511,
	TICKS_PER_SECOND/6 / 512,
};

// Low speed lookup table. "* 2" because it simplifies some calculations in com_time_to_rps().
PROGMEM const uint16_t speed_lutL[] = {
	TICKS_PER_SECOND/6 / 512 * 2,
	TICKS_PER_SECOND/6 / 640 * 2,
	TICKS_PER_SECOND/6 / 768 * 2,
	TICKS_PER_SECOND/6 / 896 * 2,
	TICKS_PER_SECOND/6 / 1024 * 2,
	TICKS_PER_SECOND/6 / 1152 * 2,
	TICKS_PER_SECOND/6 / 1280 * 2,
	TICKS_PER_SECOND/6 / 1408 * 2,
	TICKS_PER_SECOND/6 / 1536 * 2,
	TICKS_PER_SECOND/6 / 1664 * 2,
	TICKS_PER_SECOND/6 / 1792 * 2,
	TICKS_PER_SECOND/6 / 1920 * 2,
	TICKS_PER_SECOND/6 / 2048 * 2,
	TICKS_PER_SECOND/6 / 2176 * 2,
	TICKS_PER_SECOND/6 / 2304 * 2,
	TICKS_PER_SECOND/6 / 2432 * 2,
	TICKS_PER_SECOND/6 / 2560 * 2,
	TICKS_PER_SECOND/6 / 2688 * 2,
	TICKS_PER_SECOND/6 / 2816 * 2,
	TICKS_PER_SECOND/6 / 2944 * 2,
	TICKS_PER_SECOND/6 / 3072 * 2,
	TICKS_PER_SECOND/6 / 3200 * 2,
	TICKS_PER_SECOND/6 / 3328 * 2,
	TICKS_PER_SECOND/6 / 3456 * 2,
	TICKS_PER_SECOND/6 / 3584 * 2,
	TICKS_PER_SECOND/6 / 3712 * 2,
	TICKS_PER_SECOND/6 / 3840 * 2,
	TICKS_PER_SECOND/6 / 3968 * 2,
	TICKS_PER_SECOND/6 / 4096 * 2,
	TICKS_PER_SECOND/6 / 4224 * 2,
	TICKS_PER_SECOND/6 / 4352 * 2,
	TICKS_PER_SECOND/6 / 4480 * 2,
	TICKS_PER_SECOND/6 / 4608 * 2,
	TICKS_PER_SECOND/6 / 4736 * 2,
	TICKS_PER_SECOND/6 / 4864 * 2,
	TICKS_PER_SECOND/6 / 4992 * 2,
	TICKS_PER_SECOND/6 / 5120 * 2,
	TICKS_PER_SECOND/6 / 5248 * 2,
	TICKS_PER_SECOND/6 / 5376 * 2,
	TICKS_PER_SECOND/6 / 5504 * 2,
	TICKS_PER_SECOND/6 / 5632 * 2,
	TICKS_PER_SECOND/6 / 5760 * 2,
	TICKS_PER_SECOND/6 / 5888 * 2,
	TICKS_PER_SECOND/6 / 6016 * 2,
	TICKS_PER_SECOND/6 / 6144 * 2,
	TICKS_PER_SECOND/6 / 6272 * 2,
	TICKS_PER_SECOND/6 / 6400 * 2,
	TICKS_PER_SECOND/6 / 6528 * 2,
	TICKS_PER_SECOND/6 / 6656 * 2,
	TICKS_PER_SECOND/6 / 6784 * 2,
	TICKS_PER_SECOND/6 / 6912 * 2,
	TICKS_PER_SECOND/6 / 7040 * 2,
	TICKS_PER_SECOND/6 / 7168 * 2,
	TICKS_PER_SECOND/6 / 7296 * 2,
	TICKS_PER_SECOND/6 / 7424 * 2,
	TICKS_PER_SECOND/6 / 7552 * 2,
	TICKS_PER_SECOND/6 / 7680 * 2,
	TICKS_PER_SECOND/6 / 7808 * 2,
	TICKS_PER_SECOND/6 / 7936 * 2,
	TICKS_PER_SECOND/6 / 8064 * 2,
	TICKS_PER_SECOND/6 / 8192 * 2,
	TICKS_PER_SECOND/6 / 8320 * 2,
	TICKS_PER_SECOND/6 / 8448 * 2,
	TICKS_PER_SECOND/6 / 8576 * 2,
	TICKS_PER_SECOND/6 / 8704 * 2,
	TICKS_PER_SECOND/6 / 8832 * 2,
	TICKS_PER_SECOND/6 / 8960 * 2,
	TICKS_PER_SECOND/6 / 9088 * 2,
	TICKS_PER_SECOND/6 / 9216 * 2,
	TICKS_PER_SECOND/6 / 9344 * 2,
	TICKS_PER_SECOND/6 / 9472 * 2,
	TICKS_PER_SECOND/6 / 9600 * 2,
	TICKS_PER_SECOND/6 / 9728 * 2,
	TICKS_PER_SECOND/6 / 9856 * 2,
	TICKS_PER_SECOND/6 / 9984 * 2,
	TICKS_PER_SECOND/6 / 10112 * 2,
	TICKS_PER_SECOND/6 / 10240 * 2,
	TICKS_PER_SECOND/6 / 10368 * 2,
	TICKS_PER_SECOND/6 / 10496 * 2,
	TICKS_PER_SECOND/6 / 10624 * 2,
	TICKS_PER_SECOND/6 / 10752 * 2,
	TICKS_PER_SECOND/6 / 10880 * 2,
	TICKS_PER_SECOND/6 / 11008 * 2,
	TICKS_PER_SECOND/6 / 11136 * 2,
	TICKS_PER_SECOND/6 / 11264 * 2,
	TICKS_PER_SECOND/6 / 11392 * 2,
	TICKS_PER_SECOND/6 / 11520 * 2,
	TICKS_PER_SECOND/6 / 11648 * 2,
	TICKS_PER_SECOND/6 / 11776 * 2,
	TICKS_PER_SECOND/6 / 11904 * 2,
	TICKS_PER_SECOND/6 / 12032 * 2,
	TICKS_PER_SECOND/6 / 12160 * 2,
	TICKS_PER_SECOND/6 / 12288 * 2,
	TICKS_PER_SECOND/6 / 12416 * 2,
	TICKS_PER_SECOND/6 / 12544 * 2,
	TICKS_PER_SECOND/6 / 12672 * 2,
	TICKS_PER_SECOND/6 / 12800 * 2,
	TICKS_PER_SECOND/6 / 12928 * 2,
	TICKS_PER_SECOND/6 / 13056 * 2,
	TICKS_PER_SECOND/6 / 13184 * 2,
	TICKS_PER_SECOND/6 / 13312 * 2,
	TICKS_PER_SECOND/6 / 13440 * 2,
	TICKS_PER_SECOND/6 / 13568 * 2,
	TICKS_PER_SECOND/6 / 13696 * 2,
	TICKS_PER_SECOND/6 / 13824 * 2,
	TICKS_PER_SECOND/6 / 13952 * 2,
	TICKS_PER_SECOND/6 / 14080 * 2,
	TICKS_PER_SECOND/6 / 14208 * 2,
	TICKS_PER_SECOND/6 / 14336 * 2,
	TICKS_PER_SECOND/6 / 14464 * 2,
	TICKS_PER_SECOND/6 / 14592 * 2,
	TICKS_PER_SECOND/6 / 14720 * 2,
	TICKS_PER_SECOND/6 / 14848 * 2,
	TICKS_PER_SECOND/6 / 14976 * 2,
	TICKS_PER_SECOND/6 / 15104 * 2,
	TICKS_PER_SECOND/6 / 15232 * 2,
	TICKS_PER_SECOND/6 / 15360 * 2,
	TICKS_PER_SECOND/6 / 15488 * 2,
	TICKS_PER_SECOND/6 / 15616 * 2,
	TICKS_PER_SECOND/6 / 15744 * 2,
	TICKS_PER_SECOND/6 / 15872 * 2,
	TICKS_PER_SECOND/6 / 16000 * 2,
	TICKS_PER_SECOND/6 / 16128 * 2,
	TICKS_PER_SECOND/6 / 16256 * 2,
	TICKS_PER_SECOND/6 / 16384 * 2,
	TICKS_PER_SECOND/6 / 16512 * 2,
	TICKS_PER_SECOND/6 / 16640 * 2,
	TICKS_PER_SECOND/6 / 16768 * 2,
	TICKS_PER_SECOND/6 / 16896 * 2,
	TICKS_PER_SECOND/6 / 17024 * 2,
	TICKS_PER_SECOND/6 / 17152 * 2,
	TICKS_PER_SECOND/6 / 17280 * 2,
	TICKS_PER_SECOND/6 / 17408 * 2,
	TICKS_PER_SECOND/6 / 17536 * 2,
	TICKS_PER_SECOND/6 / 17664 * 2,
	TICKS_PER_SECOND/6 / 17792 * 2,
	TICKS_PER_SECOND/6 / 17920 * 2,
	TICKS_PER_SECOND/6 / 18048 * 2,
	TICKS_PER_SECOND/6 / 18176 * 2,
	TICKS_PER_SECOND/6 / 18304 * 2,
	TICKS_PER_SECOND/6 / 18432 * 2,
	TICKS_PER_SECOND/6 / 18560 * 2,
	TICKS_PER_SECOND/6 / 18688 * 2,
	TICKS_PER_SECOND/6 / 18816 * 2,
	TICKS_PER_SECOND/6 / 18944 * 2,
	TICKS_PER_SECOND/6 / 19072 * 2,
	TICKS_PER_SECOND/6 / 19200 * 2,
	TICKS_PER_SECOND/6 / 19328 * 2,
	TICKS_PER_SECOND/6 / 19456 * 2,
	TICKS_PER_SECOND/6 / 19584 * 2,
	TICKS_PER_SECOND/6 / 19712 * 2,
	TICKS_PER_SECOND/6 / 19840 * 2,
	TICKS_PER_SECOND/6 / 19968 * 2,
	TICKS_PER_SECOND/6 / 20096 * 2,
	TICKS_PER_SECOND/6 / 20224 * 2,
	TICKS_PER_SECOND/6 / 20352 * 2,
	TICKS_PER_SECOND/6 / 20480 * 2,
	TICKS_PER_SECOND/6 / 20608 * 2,
	TICKS_PER_SECOND/6 / 20736 * 2,
	TICKS_PER_SECOND/6 / 20864 * 2,
	TICKS_PER_SECOND/6 / 20992 * 2,
	TICKS_PER_SECOND/6 / 21120 * 2,
	TICKS_PER_SECOND/6 / 21248 * 2,
	TICKS_PER_SECOND/6 / 21376 * 2,
	TICKS_PER_SECOND/6 / 21504 * 2,
	TICKS_PER_SECOND/6 / 21632 * 2,
	TICKS_PER_SECOND/6 / 21760 * 2,
	TICKS_PER_SECOND/6 / 21888 * 2,
	TICKS_PER_SECOND/6 / 22016 * 2,
	TICKS_PER_SECOND/6 / 22144 * 2,
	TICKS_PER_SECOND/6 / 22272 * 2,
	TICKS_PER_SECOND/6 / 22400 * 2,
	TICKS_PER_SECOND/6 / 22528 * 2,
	TICKS_PER_SECOND/6 / 22656 * 2,
	TICKS_PER_SECOND/6 / 22784 * 2,
	TICKS_PER_SECOND/6 / 22912 * 2,
	TICKS_PER_SECOND/6 / 23040 * 2,
	TICKS_PER_SECOND/6 / 23168 * 2,
	TICKS_PER_SECOND/6 / 23296 * 2,
	TICKS_PER_SECOND/6 / 23424 * 2,
	TICKS_PER_SECOND/6 / 23552 * 2,
	TICKS_PER_SECOND/6 / 23680 * 2,
	TICKS_PER_SECOND/6 / 23808 * 2,
	TICKS_PER_SECOND/6 / 23936 * 2,
	TICKS_PER_SECOND/6 / 24064 * 2,
	TICKS_PER_SECOND/6 / 24192 * 2,
	TICKS_PER_SECOND/6 / 24320 * 2,
	TICKS_PER_SECOND/6 / 24448 * 2,
	TICKS_PER_SECOND/6 / 24576 * 2,
	TICKS_PER_SECOND/6 / 24704 * 2,
	TICKS_PER_SECOND/6 / 24832 * 2,
	TICKS_PER_SECOND/6 / 24960 * 2,
	TICKS_PER_SECOND/6 / 25088 * 2,
	TICKS_PER_SECOND/6 / 25216 * 2,
	TICKS_PER_SECOND/6 / 25344 * 2,
	TICKS_PER_SECOND/6 / 25472 * 2,
	TICKS_PER_SECOND/6 / 25600 * 2,
	TICKS_PER_SECOND/6 / 25728 * 2,
	TICKS_PER_SECOND/6 / 25856 * 2,
	TICKS_PER_SECOND/6 / 25984 * 2,
	TICKS_PER_SECOND/6 / 26112 * 2,
	TICKS_PER_SECOND/6 / 26240 * 2,
	TICKS_PER_SECOND/6 / 26368 * 2,
	TICKS_PER_SECOND/6 / 26496 * 2,
	TICKS_PER_SECOND/6 / 26624 * 2,
	TICKS_PER_SECOND/6 / 26752 * 2,
	TICKS_PER_SECOND/6 / 26880 * 2,
	TICKS_PER_SECOND/6 / 27008 * 2,
	TICKS_PER_SECOND/6 / 27136 * 2,
	TICKS_PER_SECOND/6 / 27264 * 2,
	TICKS_PER_SECOND/6 / 27392 * 2,
	TICKS_PER_SECOND/6 / 27520 * 2,
	TICKS_PER_SECOND/6 / 27648 * 2,
	TICKS_PER_SECOND/6 / 27776 * 2,
	TICKS_PER_SECOND/6 / 27904 * 2,
	TICKS_PER_SECOND/6 / 28032 * 2,
	TICKS_PER_SECOND/6 / 28160 * 2,
	TICKS_PER_SECOND/6 / 28288 * 2,
	TICKS_PER_SECOND/6 / 28416 * 2,
	TICKS_PER_SECOND/6 / 28544 * 2,
	TICKS_PER_SECOND/6 / 28672 * 2,
	TICKS_PER_SECOND/6 / 28800 * 2,
	TICKS_PER_SECOND/6 / 28928 * 2,
	TICKS_PER_SECOND/6 / 29056 * 2,
	TICKS_PER_SECOND/6 / 29184 * 2,
	TICKS_PER_SECOND/6 / 29312 * 2,
	TICKS_PER_SECOND/6 / 29440 * 2,
	TICKS_PER_SECOND/6 / 29568 * 2,
	TICKS_PER_SECOND/6 / 29696 * 2,
	TICKS_PER_SECOND/6 / 29824 * 2,
	TICKS_PER_SECOND/6 / 29952 * 2,
	TICKS_PER_SECOND/6 / 30080 * 2,
	TICKS_PER_SECOND/6 / 30208 * 2,
	TICKS_PER_SECOND/6 / 30336 * 2,
	TICKS_PER_SECOND/6 / 30464 * 2,
	TICKS_PER_SECOND/6 / 30592 * 2,
	TICKS_PER_SECOND/6 / 30720 * 2,
	TICKS_PER_SECOND/6 / 30848 * 2,
	TICKS_PER_SECOND/6 / 30976 * 2,
	TICKS_PER_SECOND/6 / 31104 * 2,
	TICKS_PER_SECOND/6 / 31232 * 2,
	TICKS_PER_SECOND/6 / 31360 * 2,
	TICKS_PER_SECOND/6 / 31488 * 2,
	TICKS_PER_SECOND/6 / 31616 * 2,
	TICKS_PER_SECOND/6 / 31744 * 2,
	TICKS_PER_SECOND/6 / 31872 * 2,
	TICKS_PER_SECOND/6 / 32000 * 2,
	TICKS_PER_SECOND/6 / 32128 * 2,
	TICKS_PER_SECOND/6 / 32256 * 2,
	TICKS_PER_SECOND/6 / 32384 * 2,
	TICKS_PER_SECOND/6 / 32512 * 2,
	TICKS_PER_SECOND/6 / 32640 * 2,
	TICKS_PER_SECOND/6 / 32768 * 2,
};



/*

// LUT generator, C++

using namespace std;
#include <fstream>

int main(int x, char** y)
{
	ofstream f("file.txt");
	f << "PROGMEM const uint16_t speed_lutH[] = {" << endl;
	for (int i = 1; i <= 16; i++) {
		f << "\tTICKS_PER_SECOND/6 / " << i << " > 65535? 65535 : TICKS_PER_SECOND/6 / " << i << ", " << endl;
	}
	for (int i = 17; i <= 512; i++) {
		f << "\tTICKS_PER_SECOND/6 / " << i << "," << endl;
	}
	f << "};" << endl;
	f << endl;
	f << "PROGMEM const uint16_t speed_lutL[] = {" << endl;
	for (int i = 512; i <= 32768; i+=128) {
		f << "\tTICKS_PER_SECOND/6 / " << i << " * 2," << endl;
	}
	f << "};" << endl;
	system("PAUSE");
}
*/

#endif /* SPEED_H_ */